<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard — Azizi POS</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body data-page="dashboard">
<header class="topbar">
  <div class="brand">Azizi POS — Offline</div>
  <nav class="nav">
    <a href="dashboard.html" id="nav-dashboard">Dashboard</a>
    <a href="products.html" id="nav-products">Produk</a>
    <a href="purchase.html" id="nav-purchase">Stok IN</a>
    <a href="pos.html" id="nav-pos">POS</a>
    <a href="reports.html" id="nav-reports">Laporan</a>
    <a href="cash.html" id="nav-cash">Kasir</a>
    <a href="settings.html" id="nav-settings">Pengaturan</a>
    <a href="backup.html" id="nav-backup">Backup</a>
  </nav>
</header>

<main class="container">
  <div class="alert"><strong>Perhatian:</strong> Versi offline (HTML+CSS+JS) — data disimpan di <em>LocalStorage</em>.</div>

  <section>
    <h2>Dashboard</h2>
    <div class="grid">
      <div class="card stat"><div class="stat-num" id="statProducts">0</div><div class="stat-label">Total Produk</div></div>
      <div class="card stat"><div class="stat-num" id="statSalesToday">Rp 0</div><div class="stat-label">Penjualan Hari Ini</div></div>
      <div class="card stat"><div class="stat-num" id="statItemsToday">0</div><div class="stat-label">Item Terjual Hari Ini</div></div>
    </div>
    <div class="card">
      <h3>Penjualan 7 Hari Terakhir</h3>
      <canvas id="salesChart" width="800" height="320" aria-label="Grafik penjualan 7 hari" role="img"></canvas>
    </div>
  </section>
</main>

<footer class="footer">
  <small>&copy; <span id="year"></span> Azizi POS — Offline HTML+CSS+JS.</small>
</footer>

<script src="js/core.js"></script>
<script>
// Highlight active nav item
document.getElementById('nav-dashboard')?.classList.add('active');
document.getElementById('year').textContent = new Date().getFullYear();

(function(){
  if(!window.DB || !window.core){
    console.warn('core.js belum dimuat.');
    return;
  }
  const $ = s => document.querySelector(s);
  // --- Stats ---
  const today = core.todayStr();
  let salesToday = 0, itemsToday = 0;
  (DB.sales||[]).forEach(sale => {
    if((sale.createdAt||'').slice(0,10) === today){
      salesToday += sale.total||0;
      (sale.items||[]).forEach(it => itemsToday += it.qty||0);
    }
  });
  $("#statProducts").textContent = (DB.products||[]).length;
  $("#statSalesToday").textContent = core.fmtRp(salesToday);
  $("#statItemsToday").textContent = itemsToday;

  // --- Chart last 7 days ---
  const labels = [];
  const values = [];
  for(let i=6;i>=0;i--){
    const d = new Date(); d.setDate(d.getDate()-i);
    const key = d.toISOString().slice(0,10);
    labels.push(key);
    const sum = (DB.sales||[])
      .filter(s => (s.createdAt||'').slice(0,10) === key)
      .reduce((a,b)=> a + (b.total||0), 0);
    values.push(sum);
  }
  const c = document.getElementById('salesChart');
  const ctx = c.getContext('2d');
  const w=c.width, h=c.height, pad=30;
  const max = Math.max(1, ...values);
  ctx.clearRect(0,0,w,h);
  ctx.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";

  // axis
  ctx.beginPath();
  ctx.moveTo(pad,pad);
  ctx.lineTo(pad,h-pad);
  ctx.lineTo(w-pad,h-pad);
  ctx.stroke();

  // bars
  const n=values.length, gap=(w-pad*2)/n, barW=gap*0.6;
  values.forEach((v,i)=>{
    const x = pad + i*gap + (gap-barW)/2;
    const barH = (v/max)*(h-pad*2);
    ctx.fillRect(x, h-pad-barH, barW, barH);
    // x labels (MM-DD)
    ctx.save();
    ctx.translate(x, h-pad+12);
    ctx.rotate(-Math.PI/6);
    ctx.fillText(labels[i].slice(5), 0, 0);
    ctx.restore();
  });
  ctx.fillText("max: "+core.fmtRp(max), 40, 20);
})();
</script>
</body>
</html>
